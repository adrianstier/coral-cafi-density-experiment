# ==============================================================================
        # Figure Generation: total_abundance_by_treatment
        # ==============================================================================
        # Purpose: Treatment comparison of Total CAFI Abundance
        #
        # Inputs:
        #   #   - Data: cafi
#   - Data: treatment
        #
        # Outputs:
        #   #   - output/MRB/figures/total_abundance_by_treatment.png/pdf
        #
        # Dependencies:
        #   #   - 1.libraries.R
        #
        # Generated by: CAFI Agent System
        # Generated on: 2026-01-11 06:09
        # ==============================================================================

        # Load libraries and utilities
        source(here::here("scripts", "MRB", "1.libraries.R"))
        source(here::here("scripts", "MRB", "utils.R"))
        source(here::here("scripts", "MRB", "mrb_figure_standards.R"))

# ==============================================================================
# LOAD DATA
# ==============================================================================

cafi_data <- load_cafi_data()
treatment_data <- load_treatment_data()

# ==============================================================================
# DATA PREPARATION
# ==============================================================================

# Add any data transformations here

# ==============================================================================
# GENERATE FIGURES
# ==============================================================================

# ------------------------------------------------------------------------------
# total_abundance_by_treatment_plot
# ------------------------------------------------------------------------------

total_abundance_by_treatment_plot <- ggplot(analysis_data, aes(x = treatment, y = total_abundance, fill = treatment)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.7) +
  labs(
    title = "Total CAFI Abundance by Treatment",
    x = "Treatment (# Corals)",
    y = "Total CAFI Abundance"
  ) +
  theme_cafi_pub()

# Apply treatment color scale
total_abundance_by_treatment_plot <- total_abundance_by_treatment_plot +
  scale_fill_manual(values = treatment_colors, labels = treatment_labels)
# Save figure
save_both(
  total_abundance_by_treatment_plot,
  here::here("output/MRB/figures/agent_generated/total_abundance_by_treatment"),
  width = 8,
  height = 6
)

# ==============================================================================
# SCRIPT COMPLETE
# ==============================================================================
message("Figure script complete: total_abundance_by_treatment")
